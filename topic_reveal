# HG changeset patch
# Parent a0a65573a2c221e07e7b8af4b0dd89d56ee57311

diff -r a0a65573a2c2 ircd/m_topic.c
--- a/ircd/m_topic.c	Sun Jul 14 19:05:53 2013 +0100
+++ b/ircd/m_topic.c	Sun Jul 14 19:08:02 2013 +0100
@@ -168,6 +168,7 @@
 int ms_topic(struct Client* cptr, struct Client* sptr, int parc, char* parv[])
 {
   struct Channel *chptr;
+  struct Membership* member;
   char *topic = 0, *name, *p = 0;
   time_t ts = 0;
 
@@ -201,6 +202,10 @@
     if (parc > 4 && (ts = atoi(parv[3])) && chptr->topic_time > ts)
       continue;
 
+    /* Reveal delayedjoin user */
+    if ((member = find_member_link(chptr, sptr)) && IsDelayedJoin(member))
+      RevealDelayedJoin(member);
+
     do_settopic(sptr,cptr,chptr,topic, ts);
   }
   return 0;
