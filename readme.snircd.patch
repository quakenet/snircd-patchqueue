# HG changeset patch
# Parent 1846eb33c5da99c2819d912f91c8019b3b04580d

diff -r 1846eb33c5da doc/readme.snircd
--- a/doc/readme.snircd
+++ b/doc/readme.snircd
@@ -4,9 +4,10 @@
 ircu. This version is based on version 2.10.12 released by Undernet's
 Coder Committee. The original code can be obtained from their webpage,
 http://coder-com.undernet.org and the latest release of Snircd can be obtained
-from QuakeNet's Development Team webpage, http://development.quakenet.org.
+from QuakeNet's Development Team webpage, http://hg.quakenet.org.
 
 - version history ------------------------------------------------------------
+v1.3.4,   HG,  unknown...
 v1.3.1,   HG,  bug fixes, warn user if input line is too long.
           WWW, 10/11/2007
 v1.3.0,   SVN, upstream patches/migration to u2.10.12.10
@@ -93,215 +94,348 @@
 
  * Oper mode +X
      Allows opers to:
-       - Join invite only (+i) channels
-       - Join keyed (+k) channels
-       - Join channels if banned
-       - Join full channels
-       - Override user mode +k
+       - Join channels through any restrictive channel modes
+         including channel bans
+       - Speak on channels through restrictive modes (+nmrM)
+         including channel bans
+       - Override usermode +k on other opers,
+         but not on +k service on a +s server.
+       - Override usermodes +R and +q
 
  * Oper mode +k
-     Allows opers to set user mode +k, network service, which prohibits
-     kicks, deops and kills.
+     Allows opers to set usermode +k, network service,
+     which prohibits kicks, deops and kills.
+
+ * Oper mode +P
+     Oper is paranoid.
 
  * Oper mode +n
-     Allows opers to hide the channels they are in.
+     Allows opers to hide the channels they are in from ordinary users.
 
  * Oper mode +I
-     Allows opers to hide their idle time.
+     Allows opers to hide their idle time from ordinary users.
 
  * User mode +R
-     Allows users to only accept privmsg/notice/invite from authed users.
+     Allows users to only accept PRIVMSG/NOTICE/INVITE from users with an account set.
+
+ * User mode +q
+     Allows users to only accept PRIVMSG/NOTICE/INVITE from users they share a channel with.
+
+ * User mode +Q
+     Prohibits users from sending PRIVMSG/NOTICE/INVITE to users they do not share a channel with.
 
  * Channel mode +c
      Prohibits mIRC & ANSI colour codes as well as other control codes from
-     being sent to a channel.
+     being sent to a channel. Bold(2), Color(3), Reverse(22), Italic (29), Underline(31).
 
  * Channel mode +C
-     Prohibits CTCPs from being sent to a channel.
+     Prohibits CTCPs from being sent to a channel,
+     with the exception of CTCP ACTION.
 
  * Channel mode +N
      Prohibits channel notices from being sent to a channel.
 
- * Channel mode +D and +d
-     'Delayed join' mode, when set on a channel joins and parts for that
-     channel are squelched. A user will be 'invisible' in the channel
-     from other users until they speak, are opped/voiced or change the
-     topic. When the +D mode is cleared, 'invisible' users will not be
-     revealed, instead the +d mode will automatically be set by the ircd
-     if invisible users remain in the channel. +d will be automatically
-     removed when the last 'invisible' user either becomes visible or
-     leaves the channel. It is possible to see the 'invisible' users
-     on a channel by doing /NAMES -d.
-
  * Channel mode +u
      Hides your quit and part messages from channels with +u set. If a user
      is in any +u channel, then their quit message is removed.
 
  * Channel mode +M
-     Disallows unauthed users to speak or change nick in a channel when they 
-     are not voiced or opped in a channel
+     Disallows users without an account set to speak or change nick in a channel when they 
+     are not voiced or opped in a channel.
 
  * Channel mode +T 
-    Blocks multi-target messages to a channel
+    Blocks multi-target messages to a channel.
 
- * Command /check
-     Allows opers to see information about a channel, user or server.
-     Syntax: Check Channel: /check <#channel> [-i|-o|-u]
-             Check Server:  /check <server>
-             Check User:    /check <nick|hostmask|CIDR> [-c]
+ * Command /CHECK
+     Allows opers to see information about a channel, user, mask or server.
+     Syntax: Check Channel: /CHECK <#channel> [-<flags>]
+             Check Server:  /CHECK <server>
+             Check User:    /CHECK <nick!user@host> [-<flags>]
 
-     Performing a /check on a server returns its status:
+     flags:
+     -c  Show channels the user is on (mask)
+     -i  Show IP instead of host (channel, mask)
+     -l  show oplevel (channel)
+     -o  Show only channel operators (channel)
+     -s  Show servername instead of realname (channel, mask)
+     -u  Do not show channel members (channel)
+     -C  Show clone count for channel members (channel)
+     -I  Include IP (channel)
+
+     Performing a /CHECK on a server returns its status:
        *  bursting
        !  awaiting burst acknowledgement
        =  network service
        +  network hub
 
- * Sethost allows opers (and users w/ passwords) to set their hostname,
-   also known as spoofing. Sethost is configured from the config file via
-   S: lines and several F: lines. Sethost is done through the /sethost
-   command or by setting user mode +h. Available Sethosts are visible by
-   using the /stats s command.
-   Syntax: Oper Sethost: /sethost <new ident> <new hostname>
-                         /mode <nick> +h <new ident>@<new hostname>
-           User Sethost: /sethost <new hostname> <password>
-                         /mode <nick> +h <new hostname> <password>
+ * SETHOST: Sethost allows opers (and users w/ passwords) to set their hostname,
+            also known as spoofing. Sethost is configured from the config file via
+            Spoof blocks and several features. Sethost is done through the /SETHOST
+            command or by setting usermode +h. Only opers are allowed to remove their sethost.
+            Available Sethosts are visible by using the /STATS s|spoofhosts command.
 
- * Single letter nicks are protected for use by network services only.
+            Syntax:
+            Oper Sethost:   /SETHOST <new user> <new hostname>
+                            /MODE <nick> +h <new user>@<new hostname>
+            User Sethost:   /SETHOST <new hostname> <password>
+                            /MODE <nick> +h <new hostname> <password>
+            Remove Sethost: /SETHOST undo
+                            /MODE <nick> -h
 
- * Protection from net rider's joining +i/+k channels after a net.join.
+ * REMOTESETHOST: Allow a server with a Uworld block to remotely set a sethost on a user.
+                  P10 syntax "<source server numeric> SH <target user numeric> <spoof user> <spoof host>"
+                  The SH command travels from source server to the server of the target user,
+                  from there a normal usermode change is broadcasted.
 
- * Topics can by sent during bursts to keep them synced throughout a network.
+ * GLINE: Ability to Gline a nick, new format now nick!user@host.
+          Changing nick and Gline matches the newnick!user@host,
+          the change is refused for erroneous nick error.
 
- * Ability to Gline a nick, new format now nick!ident@host.
+ * BADCHAN: Ability to use wildcards in BADCHANs (Glines on a channel)
+            to deny access to channel names matching the badchan.
+            When a badchan is placed, users on the channel(s) affected
+            are kicked from the channel by their server.
 
- * /stats C & H show full details for Opers.
+ * USERHOST/USERIP: Show real host and IP to opers.
 
- * Ability to restart the resolver via /rehash and /DNS r.
+ * OPLEVELS: Oplevels below 100 (0-99) are only setable by a service (define MINOPLEVEL).
+             Known issue: restriction applies to server modes too,
+             causing a desynch in oplevels when modes are bounced (HACK3).
 
- * Ability for services to send BURST outside of net.burst.
+ * MODE: Disallow ordinary users to see the banlist (/MODE #chan b)
+         when they are not on the channel.
 
-- configuration file options ------------------------------------------------
+ * SNOMASK: Default snomask for opers changed, removed SNO_HACK4.
 
-S: Sethost Lines 
- Syntax:  S:<spoof host>:<password>:<*.host.cc|a.b.c.*|CIDR>:<ident>
- Example: S:moo.fish.moo:elitepassword:host.example.com:user
+ * OPER: Opers cannot excess flood
+         Opers rate limited to 1 command per 1 second (instead 1 command of per 2 seconds)
+         Opers always have a free target
 
- This adds the sethost 'moo.fish.moo' that can be activated by a user by using
- the password 'elitepassword' and will automatically be applied to anyone
- connecting from 'host.example.com' with the ident 'user'.
+ * TOPICLEN: Define for TOPICLEN changed from 160 to 250.
 
- More Examples:
-   Oper sethost for 'moo.fish.moo'
-          S:moo.fish.moo:::
-   User & Oper sethost for 'moo.fish.moo'
-          S:moo.fish.moo:elitepassword::
-   Oper sethost for 'moo.fish.moo' with auto on 'ident@*.example.com"
-          S:moo.fish.moo::*.example.com:ident
+ * FREETARGETS: Start free targets changed from 10 to 20.
 
-F:SETHOST
+ * BADUSER: Rules for a bad username relaxed.
+
+ * JOIN: Changed error message when joining channels, numeric replies:
+         471 ERR_CHANNELISFULL  "Cannot join channel, channel is full (+l)"
+         473 ERR_INVITEONLYCHAN "Cannot join channel, you must be invited (+i)"
+         474 ERR_BANNEDFROMCHAN "Cannot join channel, you are banned (+b)"
+         475 ERR_BADCHANNELKEY  "Cannot join channel, you need the correct key (+k)"
+         477 ERR_NEEDREGGEDNICK "Cannot join channel (+r): 
+                                 this channel requires authentication --
+                                 For details of how to obtain an account visit <url>"
+         479 ERR_BADCHANNAME    "Cannot join channel (G-lined: <reason>)"
+
+ * ACCOUNT: Parameter account ID added to ACCOUNT command and usermode +r param.
+            Account timestamp and id are allowed to be set, even when the user has an account set already,
+            provided the account set on the user and the account in the AC message are the same,
+            and no account timestamp and id are set. The timestamp can be used to identify the session,
+            and ID can be used to identify the account. Accounts expire and account names
+            are reused, account IDs are not and can be used to unique identify a user.
+            P10 syntax "<source server numeric> AC <target user numeric> <account> [<timestamp> [<ID>]]
+                       "+r <account>[:<timestamp>[:<ID>]]" in N (NICK) message introducing the user
+
+ * ACCOUNTLEN: ACCOUNTLEN increased from 12 to 15 (define ACCOUNTLEN).
+
+ * WHOIS: Changed numeric reply 330 RPL_WHOISACCOUNT text from "is logged in as" to "is authed as".
+
+ * HASH: Disallow ordinary users using /HASH.
+
+ * SERVER: Added server flag n (send oper names), usermode +o has the opername (used to /OPER) as parameter.
+           A server linking with flag n is expected to send and parse opername as parameter to usermode +o.
+           Max length of an opername is 15 (define ACCOUNTLEN).
+           A "-" char (define NOPERNAMECHARACTER) is used as opername when a server does not send them.
+           A service can use this char as opername as well, since opernames for a service have little meaning.
+           Added numeric reply 343 RPL_WHOISOPERNAME "<nick> :is opered as", shown to opers in /WHOIS.
+
+- configuration options ------------------------------------------------
+
+Privileges for opers:
+
+ * chanserv = yes;
+   Default: yes
+   Allow oper to set usermode +k
+
+ * xtra_oper = yes;
+   Default: yes
+   Allow oper to set usermode +X
+
+ * noidle = yes;
+   Default: yes
+   Allow oper to set usermode +n
+
+ * freeform = yes;
+   Default: yes
+   Allow oper to use set spoof host without requiring a matching Spoof block
+
+ * paranoid = yes;
+   Default: yes
+   Allow oper to set usermode +P
+
+ * check = yes;
+   Default: yes
+   Allow oper to use /CHECK
+
+
+Spoof block
+
+ * Syntax
+   Spoofhost "spoofhost" {
+     username = "user";
+     host = "host";
+     password = "password";
+   };
+
+ * Example
+   Spoofhost "cows.go.moo" {
+     username = "john";
+     host = "1.2.3.4";
+     password = "JH63Acd3e";
+   };
+
+  This adds the sethost 'cows.go.moo' that can be activated by a user by using
+  the password 'JH63Acd3e' and will automatically be applied to anyone
+  connecting from '1.2.3.4' with the username 'john'.
+
+ * Oper sethost for 'cows.go.moo'
+   Spoofhost "cows.go.moo" {
+   };
+
+ * User & Oper sethost for 'moo.fish.moo'
+   Spoofhost "cows.go.moo" {
+     password = "JH63Acd3e";
+   };
+
+ * Oper sethost for 'moo.fish.moo' with auto on 'john@*.example.com"
+   Spoofhost "cows.go.moo" {
+     username = "john";
+     host = "*.example.com";
+   };
+
+Feature settings
+
+SETHOST
  * Type: boolean
  * Default: FALSE
 
- This enables the /sethost command and user mode +h for opers activating Sethosts.
+ This enables the /SETHOST command and usermode +h for opers activating Sethosts.
 
-F:SETHOST_USER
+SETHOST_USER
  * Type: boolean
  * Default: FALSE
 
- This enabled the /sethost command and user mode +h for users activating Sethosts
+ This enabled the /SETHOST command and usermode +h for users activating Sethosts
  with passwords.
 
-F:SETHOST_AUTO
+SETHOST_AUTO
  * Type: boolean
  * Default: FALSE
 
- This enables the automatic application of Sethosts on matching idents and hosts.
+ This enables the automatic application of Sethosts on matching user@host.
 
-F:SETHOST_FREEFORM
+SETHOST_FREEFORM
  * Type: boolean
  * Default: FALSE
 
- This enables opers to set new hostnames that do not have a corresponding S: line
+ This enables opers to set new hostnames that do not have a corresponding Spoof block
  in the configuration file, as long as the hostname supplied is reasonably valid.
- The usage if this is logged via SNOTICE.
+ The usage of this is logged via SNOTICE on OLDSNO and through LOG facility.
 
-F:HIS_STATS_s
+HIS_STATS_s
  * Type: boolean
  * Default: TRUE
 
- As per QuakeNet Security, this removes the /stats s from users.
+ As per QuakeNet Security, this removes the /STATS s from users.
 
-F:TOPIC_BURST
- * Type: boolean
- * Default: FALSE
-
- This selects whether topics are *sent* to other servers during a burst.
- Note that receiving topics from servers is always enabled.
-
-F:HIS_GLINE
+HIS_GLINE
  * Type: boolean
  * Default: TRUE
 
  As per QuakeNet Security, this removes the reason for GLINE from quit messages.
 
-F:SOCKSENDBUF
- * Type: integer
- * Default: 61440
-
- Sets the socket buffer for sending. Advanced feature, do not change unless you
- known what you are doing.
-
-F:SOCKRECVBUF
- * Type: integer
- * Default: 61440
-
- Sets the socket buffer for recieving. Advanced feature, do not change unless you
- known what you are doing.
-
-F:USER_HIDECHANS
+USER_HIDECHANS
  * Type: boolean
  * Default: FALSE
 
- This allows normal users to set the +n usermode (hide channels from whois/who),
+ This allows normal users to set the +n usermode (hide channels from WHOIS/WHO),
  this is only recommended in special circumstances.
 
-F:HIS_USERGLINE
+USER_HIDEIDLETIME
+ * Type: boolean
+ * Default: FALSE
+
+ This allows normal users to set the +I usermode (hide idle time whois),
+ this is only recommended in special circumstances.
+
+HIS_USERGLINE
  * Type: boolean
  * Default: TRUE
 
  This enables / disables the ability for users to use the /GLINE command for
- listing active glines. It's turned on by default, which is the opposite
- behaviour of vanilla ircu.
+ listing glines. Default value has been changed from FALSE TO TRUE.
 
-F:AUTOINVISIBLE
+AUTOINVISIBLE
  * Type: boolean
  * Default: TRUE
 
- As per QuakeNet Security, this option sets user mode +i on all connecting clients
- automatically.
+ As per QuakeNet Security, this option sets usermode +i on all connecting clients
+ automatically and disallows users to set usermode -i.
 
-F:HIS_USERIP
+HIS_USERIP
  * Type: boolean
  * Default: TRUE
 
- As per QuakeNet Security, add the ability to disable the /USERIP command for users.
+ As per QuakeNet Security, add the ability to hide the IP in /USERIP and /WHO
+ from users. The IP set in feature HIDDEN_IP is shown instead.
+ Also disallow users from matching IP using /WHO <mask> i.
 
-F:AUTOCHANMODES
+AUTOCHANMODES
  * Type: boolean
  * Default: TRUE
 
  Enable or disable auto (default) channel modes for new channels.
 
-F:AUTOCHANMODES_LIST
+AUTOCHANMODES_LIST
  * Type: string
  * Default: "ntCN"
 
  AUTOCHANMODES_LIST should contain the default channelmodes (e.g. "ntCN") which will 
  be set by default on new channels.
 
+EXTENDED_CHECKCMD
+ * Type: boolean
+ * Default: FALSE
+
+ Adds more info to the output of the /CHECK command.
+
+HIS_STATS_w
+ * Type: boolean
+ * Default: TRUE
+
+ Changed default value from FALSE to TRUE.
+
+HIS_STATS_u
+ * Type: boolean
+ * Default: TRUE
+
+ Changed default value from FALSE to TRUE.
+
+NICKLEN
+ * Type: integer
+ * Default: 15
+
+ Changed default value from 12 to 15.
+
+HIS_LUSERS_ME
+ * Type: boolean
+ * Default: FALSE
+
+ Hide number of local servers linked in /LUSERS output from ordinary users.
+
 - disclaimer ----------------------------------------------------------------
 
 This software is provided "as is" with absolutely no warranties, either express
 or implied. It's use is done so totally at the user's own risk.
 
------------------------- 10.11.2007 -----------------------------------------
+------------------------ 06.07.2013 -----------------------------------------
