# HG changeset patch
# Parent 43da6be4706ddafe15ad60cabb2753d6553e1d7f

Info fix from snircd 1.4.0.

http://hg.quakenet.org/snircd/rev/5f40b7be63b9
http://hg.quakenet.org/snircd/rev/c8b7fb9e8fa8

diff -r 43da6be4706d include/version.h
--- a/include/version.h
+++ b/include/version.h
@@ -9,6 +9,7 @@
 extern const char *version;
 extern const char *creation;
 extern const char *infotext[];
+extern const char *sourcestext[];
 extern const char *generation;
 
 #endif /* INCLUDED_version_h */
diff -r 43da6be4706d ircd/m_info.c
--- a/ircd/m_info.c
+++ b/ircd/m_info.c
@@ -105,17 +105,15 @@
  */
 int m_info(struct Client* cptr, struct Client* sptr, int parc, char* parv[])
 {
-  const char **text = infotext;
+  const char **text;
 
   if (hunt_server_cmd(sptr, CMD_INFO, cptr, 1, ":%C", 1, parc, parv) !=
       HUNTED_ISME)
-	return 0;
+    return 0;
 
-  while (text[212])
-  {
+  for (text=infotext;*text;text++)
     send_reply(sptr, RPL_INFO, *text);
-    text++;
-  }
+
   send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":Birth Date: %s, compile # %s",
       creation, generation);
   send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":On-line since %s",
@@ -133,26 +131,26 @@
  */
 int ms_info(struct Client* cptr, struct Client* sptr, int parc, char* parv[])
 {
-  const char **text = infotext;
+  const char **text;
 
   if (IsServer(sptr))
     return 0;
 
   if (hunt_server_cmd(sptr, CMD_INFO, cptr, 1, ":%C", 1, parc, parv) !=
       HUNTED_ISME)
-	return 0;
-  while (text[212])
+    return 0;
+
+  if (!IsOper(sptr))
   {
-    if (!IsOper(sptr))
+    for (text=infotext;*text;text++)    
       send_reply(sptr, RPL_INFO, *text);
-    text++;
   }
-  if (IsOper(sptr))
+  else
   {
-    while (*text)
-      send_reply(sptr, RPL_INFO, *text++);
-    send_reply(sptr, RPL_INFO, "");
+    for (text=sourcestext;*text;text++)
+      send_reply(sptr, RPL_INFO, *text);
   }
+
   send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":Birth Date: %s, compile # %s",
       creation, generation);
   send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":On-line since %s",
@@ -169,29 +167,27 @@
  */
 int mo_info(struct Client* cptr, struct Client* sptr, int parc, char* parv[])
 {
-  const char **text = infotext;
+  const char **text;
 
-  if (hunt_server_cmd(sptr, CMD_INFO, cptr, 1, ":%C", 1, parc, parv) ==
+  if (hunt_server_cmd(sptr, CMD_INFO, cptr, 1, ":%C", 1, parc, parv) !=
       HUNTED_ISME)
+    return 0;
+
+  if (!IsOper(sptr) || parv[1] == NULL)
   {
-    while (text[212])
-    {
-      if (!IsOper(sptr))
-	send_reply(sptr, RPL_INFO, *text);
-      text++;
-    }
-    if (IsOper(sptr) && (NULL != parv[1]))
-    {
-      while (*text)
-	send_reply(sptr, RPL_INFO, *text++);
-      send_reply(sptr, RPL_INFO, "");
-    }
-    send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":Birth Date: %s, compile # %s",
-	       creation, generation);
-    send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":On-line since %s",
-	       myctime(cli_firsttime(&me)));
-    send_reply(sptr, RPL_ENDOFINFO);
+    for (text=infotext;*text;text++)
+      send_reply(sptr, RPL_INFO, *text);
   }
+  else
+  {
+    for (text=sourcestext;*text;text++)
+      send_reply(sptr, RPL_INFO, *text);
+  }
+  send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":Birth Date: %s, compile # %s",
+      creation, generation);
+  send_reply(sptr, SND_EXPLICIT | RPL_INFO, ":On-line since %s",
+      myctime(cli_firsttime(&me)));
+  send_reply(sptr, RPL_ENDOFINFO);
   return 0;
 }
 
diff -r 43da6be4706d ircd/version.c.SH
--- a/ircd/version.c.SH
+++ b/ircd/version.c.SH
@@ -79,7 +79,10 @@
     "Thanks goes to all other people who contributed to any version.",
     "A full listing of all coders can be found in doc/Authors in the",
     "source.",
-    "",
+    0,
+};
+
+const char *sourcestext[] = {
     "Sources:",
 !SUB!THIS!
 
