# HG changeset patch
# Parent c99c968e39753b4284641d99cb154babfe6e021f

Show auto connect setting in STATS connect.

diff -r c99c968e3975 ircd/s_err.c
--- a/ircd/s_err.c	Wed Jul 03 20:25:44 2013 +0200
+++ b/ircd/s_err.c	Wed Jul 03 20:43:07 2013 +0200
@@ -458,7 +458,7 @@
 /* 212 */
   { RPL_STATSCOMMANDS, "%s %u %u", "212" },
 /* 213 */
-  { RPL_STATSCLINE, "C %s %s %d %s %d %s %s", "213" },
+  { RPL_STATSCLINE, "C %s %c %s %d %s %d %s %s", "213" },
 /* 214 */
   { 0 },
 /* 215 */
diff -r c99c968e3975 ircd/s_stats.c
--- a/ircd/s_stats.c	Wed Jul 03 20:25:44 2013 +0200
+++ b/ircd/s_stats.c	Wed Jul 03 20:43:07 2013 +0200
@@ -89,7 +89,7 @@
   static char null[] = "<NULL>";
   struct ConfItem *tmp;
   unsigned short int port;
-  int maximum;
+  int maximum, autoconnect;
   char *host, *pass, *name, *username, *hub_limit;
   int unmask = 0;
 
@@ -123,11 +123,16 @@
       hub_limit = BadPtr(tmp->hub_limit) ? null : tmp->hub_limit;
       maximum = tmp->maximum;
       port = tmp->address.port;
+      autoconnect = (tmp->flags & CONF_AUTOCONNECT) ? 1 : 0;
 
       if (tmp->status & CONF_UWORLD)
 	send_reply(sptr, RPL_STATSULINE, host);
       else if (tmp->status & CONF_SERVER)
-	send_reply(sptr, RPL_STATSCLINE, name, unmask ? host : "*", port, unmask ? pass : "*", maximum, hub_limit, get_conf_class(tmp));
+	send_reply(sptr, RPL_STATSCLINE, name,
+	           autoconnect ? '+' : '-',
+	           unmask ? host : "*", port,
+	           unmask ? pass : "*", maximum,
+	           hub_limit, get_conf_class(tmp));
       else if (tmp->status & CONF_CLIENT)
         send_reply(sptr, RPL_STATSILINE,
                    (tmp->username ? tmp->username : ""), (tmp->username ? "@" : ""),
